# 基于uboss 的bpm 系统开发，流程流转 sql 解读

```
--bpm 事件流程启动表 新增事件时 启动流程需插入本表
SELECT * FROM TD_EVENT_PROC_START_JOB;
--事件流程任务表
SELECT * FROM BPM_TASK_HOLDER;
-- TD_EVENT_BPM_TASK_DATA
-- 事件启动时 可插入一条启动记 TD_EVENT_BPM_TASK_DATA.TASK_LIST_ID = -1
SELECT * FROM TD_EVENT_BPM_TASK_DATA;
-- 流程参数表 启动流程参数表 如果启动后 仅跟着 判断分支需要入参 autoFlag = 1\0
SELECT * FROM TD_EVENT_PROC_START_PARAM;
--bpm 事件流转sql
-- record list 处置历史记录
SELECT
  H.HOLDER_ID,
  H.HOLDER_NO,
  H.PROC_INST_ID,
  H.PROCESS_VER_ID,
  T.TASK_LIST_ID,
  T.TASK_ID,
  T.TASK_NAME,
  T.USER_ID,
  T.TEMPLATE_ID,
  P.CODE,
  V.DEPLOY_ID,
  K.ROLE_ID,
  R.ROLE_CODE
FROM BPM_TASK_HOLDER H LEFT JOIN BPM_TASK_LIST T
    ON H.HOLDER_ID = T.HOLDER_ID
  LEFT JOIN BPM_PROCESS_TEMP_VER V
    ON H.PROCESS_VER_ID = V.PROCESS_VER_ID
  LEFT JOIN BPM_TASK_TEMPLATE P
    ON P.TEMPLATE_ID = T.TEMPLATE_ID
  LEFT JOIN bpm_user_task K
    ON K.TEMPLATE_ID = T.TEMPLATE_ID
  LEFT JOIN BFM_ROLE R
    ON R.ID = K.ROLE_ID
WHERE 1 = 1
      AND T.TASK_ID IS NOT NULL
      AND H.HOLDER_ID =
          (SELECT HOLDER_ID
           FROM TD_EVENT_PROC_START_JOB
           WHERE EVENT_ID = 1)
ORDER BY T.CREATE_DATE ASC;

SELECT * FROM BPM_TASK_HOLDER;

-- next task 下一步待处理 任务 获取后 相关数据插入 TD_EVENT_BPM_TASK_DATA 就可执行任务 进行到下一步
SELECT
  H.HOLDER_ID,
  H.HOLDER_NO,
  H.PROC_INST_ID,
  H.PROCESS_VER_ID,
  T.TASK_LIST_ID,
  T.TASK_ID,
  T.TASK_NAME,
  T.USER_ID,
  T.TEMPLATE_ID,
  P.CODE,
  V.DEPLOY_ID,
  K.ROLE_ID,
  R.ROLE_CODE
FROM BPM_TASK_HOLDER H LEFT JOIN BPM_TASK_LIST T
    ON H.HOLDER_ID = T.HOLDER_ID
  LEFT JOIN BPM_PROCESS_TEMP_VER V
    ON H.PROCESS_VER_ID = V.PROCESS_VER_ID
  LEFT JOIN BPM_TASK_TEMPLATE P
    ON P.TEMPLATE_ID = T.TEMPLATE_ID
  LEFT JOIN bpm_user_task K
    ON K.TEMPLATE_ID = T.TEMPLATE_ID
  LEFT JOIN BFM_ROLE R
    ON R.ID = K.ROLE_ID
WHERE 1 = 1 AND T.USER_ID IS NULL
      AND T.TASK_ID IS NOT NULL
      AND H.HOLDER_ID =
          (SELECT HOLDER_ID
           FROM TD_EVENT_PROC_START_JOB
           WHERE EVENT_ID = 1);


-- next task list 下一步处理任务 大于等 2 时
SELECT
  H.HOLDER_ID,
  H.HOLDER_NO,
  H.PROC_INST_ID,
  H.PROCESS_VER_ID,
  T.TASK_LIST_ID,
  T.TASK_ID,
  T.TASK_NAME,
  T.USER_ID,
  T.TEMPLATE_ID,
  P.CODE,
  V.DEPLOY_ID,
  K.ROLE_ID,
  R.ROLE_CODE
FROM BPM_TASK_HOLDER H LEFT JOIN BPM_TASK_LIST T
    ON H.HOLDER_ID = T.HOLDER_ID
  LEFT JOIN BPM_PROCESS_TEMP_VER V
    ON H.PROCESS_VER_ID = V.PROCESS_VER_ID
  LEFT JOIN BPM_TASK_TEMPLATE P
    ON P.TEMPLATE_ID = T.TEMPLATE_ID
  LEFT JOIN bpm_user_task K
    ON K.TEMPLATE_ID = T.TEMPLATE_ID
  LEFT JOIN BFM_ROLE R
    ON R.ID = K.ROLE_ID
WHERE 1 = 1 AND T.USER_ID IS NULL
      AND T.TASK_ID IS NOT NULL
      AND H.HOLDER_ID =
          (SELECT HOLDER_ID
           FROM TD_EVENT_PROC_START_JOB
           WHERE EVENT_ID = 1);
```